USE CDWQA;

SHOW PRIMARY KEYS IN SCHEMA;

SET query_id = (

  SELECT QUERY_ID

  FROM TABLE(INFORMATION_SCHEMA.QUERY_HISTORY())

  WHERE QUERY_TEXT = 'SHOW PRIMARY KEYS IN SCHEMA;'

  ORDER BY START_TIME DESC

  LIMIT 1

);

SELECT CURRENT_DATABASE(),

TABLE_SCHEMA,TABLE_NAME,COLUMN_NAME,ORDINAL_POSITION,DATA_TYPE,

CASE WHEN (SELECT count(1) FROM TABLE(RESULT_SCAN($query_id)) where $4 = cols.table_name and $5 = cols.column_name) > 0 THEN 'Y' END as PK,

CASE WHEN DATA_TYPE IN ('TEXT') THEN CHARACTER_MAXIMUM_LENGTH
WHEN DATA_TYPE IN ('NUMBER') THEN NUMERIC_PRECISION
WHEN DATA_TYPE IN ('DATE','TIMESTAMP_NTZ') THEN DATETIME_PRECISION
END LENGTH,

coalesce(NUMERIC_SCALE,0),COLUMN_DEFAULT,

CASE WHEN IS_NULLABLE='YES' THEN 'Y' ELSE 'N' END IS_NULLABLE

FROM INFORMATION_SCHEMA.COLUMNS cols

WHERE
WHERE TABLE_NAME IN ()
AND TABLE_SCHEMA IN ()
ORDER BY TABLE_NAME,ORDINAL_POSITION;